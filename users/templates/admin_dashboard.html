<!DOCTYPE html>
<html>
<head>
    <title>Employee Dashboard</title>
    <!-- Include Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
<!--    <link rel="stylesheet" href="css/styles.css">-->
    <style>
        /* Custom CSS for font color */
        .employee-dashboard-title {
            color: blue;
        }
        /* Style for the logout button */
        .logout-button {
            position: absolute;
            top: 10px;
            right: 10px;
        }
        .small-search-form {
            max-width: 300px;
        }
        .small-search-button {
            width: 100px;
        }
                .search-filter {
            display: flex;
            justify-content: flex-end;
        }
    </style>
</head>
<body style="background-color: #fff;">
    <div class="container mt-5">
        <a href="{{ url_for('login_bp.logout') }}" class="btn btn-danger logout-button">Logout</a>
        <div class="col-md-12 text-center">
            <h2 class="mb-4 employee-dashboard-title">Employee Management | Role: {{current_user.role|capitalize}}</h2>
        </div>
                {% with messages = get_flashed_messages(with_categories=true) %}
                <!-- Categories: success (green), info (blue), warning (yellow), danger (red) -->
                {% if messages %}
                {% for category, message in messages %}
                <div class="alert alert-{{category}} alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>                </div>
                {% endfor %}
                {% endif %}
                {% endwith %}
        <div class="card">
            <div class="card-body">
                <br>
                <h3><b>Employees</b></h3>
                <br>
                <div class="search-filter">
                    <form method="POST" action="{{ url_for('employee_bp.search_employees') }}" class="small-search-form input-group">
                        <input type="text" class="form-control" name="search" placeholder="Search...">
                        <div class="input-group-append">
                            <button type="submit" class="btn btn-primary small-search-button">Search</button>
                        </div>
                    </form>
                    <button type="button" class="btn btn-secondary ml-2" data-toggle="modal" data-target="#filterModal">Filter</button>
                </div>
        <div class="row">
            <div class="col-md-6 text-right">
                <a href="{{ url_for('employee_bp.create_employee') }}" class="btn btn-primary">Create Employee</a>
                <a href="{{ url_for('export_bp.export', export_type='csv') }}" class="btn btn-success">Export CSV</a>
                <a href="{{ url_for('export_bp.export', export_type='xlsx') }}" class="btn btn-success">Export XLSX</a>
                <a href="{{ url_for('export_bp.export', export_type='json') }}" class="btn btn-success">Export JSON</a>
            </div>
<br>
            <!-- Modal for employee filter -->
    <div class="modal fade" id="filterModal" tabindex="-1" role="dialog" aria-labelledby="filterModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="filterModalLabel">Filter Employees</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <!-- Filter options for designation and department -->
                    <form method="POST" action="{{ url_for('employee_bp.filter_employees') }}">
                        <div class="form-group">
                            <label for="designation">Designation</label>
                            <select class="form-control" id="designation" name="designation">
                                <!-- Add designation options dynamically if needed -->
                                {% for each in designation_choices %}
                                <option value="{{each[0]}}">{{each[1]}}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="department">Department</label>
                            <select class="form-control" id="department" name="department">
                                {% for each in department_choices %}
                                <option value="{{each[0]}}">{{each[1]}}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary">Apply Filter</button>
                    </form>
                </div>
            </div>
        </div>
            </div>
        <br>
        <!-- Employee table -->
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>Manager</th>
                    <th>Designation</th>
                    <th>Department</th>
                    <th>Action</th> <!-- Column for Edit and Delete buttons -->
                </tr>
            </thead>
            <tbody>
                {% for employee in employees %}
                <tr>
                    <td><a href="{{ url_for('employee_bp.employee_detail', employee_id=employee._id) }}">{{ employee.name }}</a></td>
                    <td>{{ employee.email }}</td>
                    <td>{{ employee.phone }}</td>
                    <td>{{ employee.manager_name }}</td>
                    <td>{{ employee.designation }}</td>
                    <td>{{ employee.department }}</td>
                    <td>
                        <a href="{{ url_for('employee_bp.edit_employee', employee_id=employee._id) }}" class="btn btn-warning btn-sm">Edit</a>
                        <a href="#" class="btn btn-danger btn-sm" data-toggle="modal" data-target="#confirmationModal {{ employee._id }}" data-employee-id="{{ employee._id }}">Delete</a>

                    </td>
                </tr>
                <div class="modal fade" id="confirmationModal {{ employee._id }}" tabindex="-1" role="dialog" aria-labelledby="confirmationModalLabel {{ employee._id }}" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="confirmationModalLabel {{ employee._id }}">Confirmation</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            Are you sure you want to delete this employee?
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                            <a id="confirmDelete" class="btn btn-danger" href="{{ url_for('employee_bp.delete_employee', employee_id=employee._id) }}">Delete</a>
                        </div>
                    </div>
                </div>
            </div>
                {% endfor %}
            </tbody>
        </table>
    </div>
        <br>
        <h3><b>Managers</b></h3>
        <br>
            <!-- Add a form for manager filtering if needed -->
        <div class="row">
            <div class="col-md-6 text-left">
                <a href="{{ url_for('manager_bp.create_manager') }}" class="btn btn-primary">Create Manager</a>
        </div>
                <br><br>
        <!-- Manager table -->
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Phone</th>
                    <th>Email</th>
<!--                    <th>Action</th> &lt;!&ndash; Column for Delete button &ndash;&gt;-->
                </tr>
            </thead>
            <tbody>
                {% for manager in managers %}
                <tr>
                    <td>{{ manager.name }}</td>
                    <td>{{ manager.phone }}</td>
                    <td>{{ manager.email }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
            </div>
                        <br>
        <h3><b>Permissions</b></h3>
            <!-- Add a form for permission filtering if needed -->
                        <div class="row">

           <div class="col-md-6 text-left">
                <a href="{{ url_for('permissions_bp.create_permission') }}" class="btn btn-primary">Create Permission</a>
        </div>
                            </div>
                <br>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Permission</th>
                    <th>Action</th> <!-- Column for Delete button -->
                </tr>
            </thead>
            <tbody>
                {% for permission in permissions %}
                <tr>
                    <td>{{ permission.name }}</td>
                    <td>
                    <a href="#" class="btn btn-danger btn-sm" data-toggle="modal" data-target="#confirmationPermissionModal{{ permission._id }}" data-permission-id="{{ permission._id }}">Delete</a>
                    </td>
                </tr>
                            <div class="modal fade" id="confirmationPermissionModal{{ permission._id }}" tabindex="-1" role="dialog" aria-labelledby="confirmationPermissionModalLabel{{ permission._id }}" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="confirmationPermissionModalLabel{{ permission._id }}">Confirmation</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            Are you sure you want to delete this permission?
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                            <a id="confirmPermissionDelete" class="btn btn-danger" href="{{ url_for('permissions_bp.delete_permission', permission_id=permission._id) }}">Delete</a>
                        </div>
                    </div>
                </div>
            </div>
                {% endfor %}
            </tbody>
        </table>
                                      <br>
        <h3><b>Roles</b></h3>
                        <div class="row">
           <div class="col-md-6 text-left">
                <a href="{{ url_for('roles_bp.create_role') }}" class="btn btn-primary">Create Role</a>
        </div>
                            </div>
                <br>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Role</th>
                    <th>Permissions</th>
                    <th>Action</th> <!-- Column for Delete button -->
                </tr>
            </thead>
            <tbody>
            {% for role in roles %}
            <tr>
                <td>{{ role.name }}</td>
                <td>{{ role.permission_names }}</td>
                <td>
                    <a href="#" class="btn btn-danger btn-sm" data-toggle="modal" data-target="#confirmationRoleModal{{ role._id }}" data-role-id="{{ role._id }}">Delete</a>
                </td>
            </tr>
            <div class="modal fade" id="confirmationRoleModal{{ role._id }}" tabindex="-1" role="dialog" aria-labelledby="confirmationRoleModalLabel{{ role._id }}" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="confirmationRoleModalLabel{{ role._id }}">Confirmation</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            Are you sure you want to delete this role?
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                            <a id="confirmRoleDelete" class="btn btn-danger" href="{{ url_for('roles_bp.delete_role', role_id=role._id) }}">Delete</a>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
            </tbody>
        </table>
        </div>
    </div>
</div>


<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>




</body>
</html>

